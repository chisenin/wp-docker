## 第十部分：部署阶段与加速器配置建议

### 🚀 部署阶段（无构建，仅拉取）

1.  **准备部署环境**:
    ```bash
    # 克隆仓库
    git clone <your-repo-url> wordpress-project
    cd wordpress-project
    # 运行部署脚本生成.env文件
    chmod +x scripts/deploy.sh
    ./scripts/deploy.sh
    ```

2.  **启动服务**:
    ```bash
    docker-compose pull    # 拉取 Actions 推送的镜像（精确版本）
    docker-compose up -d   # 启动服务
    ```

### 🧩 加速器配置建议（生产环境）

**文件：`/etc/docker/daemon.json`**

```json
{
  "registry-mirrors": ["https://mirror.ccs.tencentyun.com"]
}
```

```bash
sudo systemctl daemon-reload
sudo systemctl restart docker
```

### 🧪 已实现功能（待全面测试）

- **版本监控脚本**：`scripts/check_versions.sh` 已创建但暂未启用，将定时检查 Alpine、PHP、Nginx、Composer 和关键 apk 包的最新版本。
- **部署脚本**：`scripts/deploy.sh` 已实现，用于自动生成安全的 `.env` 文件，包含随机密码生成和 WordPress 安全密钥获取功能。

### 总结

这份指南通过 GitHub Actions 提供了一个全云端、自动化的 WordPress 部署方案，融入 **DevOps 工程化思维**：

- **动态版本锁定**：基于 Alpine 3.22，提取精确版本（如 :8.3.26），消除不确定性。
- **多阶段构建**：共享 base 镜像，优化镜像大小和构建效率。
- **配置即代码**：Git 管理所有配置文件，确保一致性和可追溯性。
- **云端 CI/CD**：Actions 完成所有构建，推送精确标签，生产仅需拉取。
- **未来扩展**：版本监控和 Release 脚本（待测试）将进一步增强自动化。

| 阶段           | 是否构建 | 是否用国内源   | 镜像处理方式                    |
| -------------- | -------- | -------------- | ------------------------------- |
| GitHub Actions | ✅ 是     | ❌ 否（官方源） | ✅ 构建、动态提取版本并推送镜像  |
| 生产部署服务器 | ❌ 不构建 | ✅ 拉取加速     | 运行部署脚本 + `pull + up` 操作 |

**故障排除**：
- **“找不到镜像”**：检查 Actions 日志，确保基础镜像（如 `php:8.3-fpm-alpine3.22`）存在。若失败，工作流会 fallback 到更宽松标签（如 `nginx:1.27-alpine`）。
- **版本更新**：运行部署脚本 `./scripts/deploy.sh` 自动更新 `.env` 文件中的版本信息。
- **环境变量问题**：确保 `.env` 文件存在且格式正确，可参考 `.env.example` 文件。

遵循此指南，您将获得一个**稳定、高效、可维护、团队友好**的 WordPress 生产环境，未来可通过启用版本监控和 Release 脚本进一步优化。

---

**本部分结束**。这是指南的第十部分（部署阶段与加速器配置建议），也是最后一部分。